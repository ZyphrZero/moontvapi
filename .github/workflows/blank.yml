name: åŒæ­¥å½±è§†æºé…ç½®

on:
  schedule:
    - cron: '0 */6 * * *'  # æ¯ 6 å°æ—¶æ‰§è¡Œä¸€æ¬¡
  workflow_dispatch:  # æ”¯æŒæ‰‹åŠ¨è§¦å‘

permissions:
  contents: write  # æ˜ç¡®æˆäºˆå†™å…¥æƒé™

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»“åº“
        uses: actions/checkout@v4
        with:
          ref: config  # ç›´æ¥æ“ä½œ config åˆ†æ”¯

      - name: æ‹‰å–é…ç½®
        run: |
          curl -o config.txt "https://odd-hall-95d8.1430066373.workers.dev/?config=1&encode=base58"
          echo "é…ç½®æ–‡ä»¶å¤§å°: $(wc -c < config.txt) bytes"

      - name: æäº¤æ›´æ–°
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          # æ£€æŸ¥æ˜¯å¦æœ‰å˜æ›´
          if ! git diff --quiet config.txt 2>/dev/null || [ ! -f config.txt ]; then
            git add config.txt
            git commit -m "ğŸ”„ è‡ªåŠ¨åŒæ­¥é…ç½® - $(date -u +'%Y-%m-%d %H:%M:%S UTC')" || echo "æ²¡æœ‰å˜æ›´éœ€è¦æäº¤"
            git push origin config
          else
            echo "é…ç½®æ–‡ä»¶æ²¡æœ‰å˜åŒ–ï¼Œè·³è¿‡æäº¤"
          fi
