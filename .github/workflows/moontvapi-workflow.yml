name: åŒæ­¥å½±è§†æºé…ç½®

on:
  schedule:
    - cron: '0 */6 * * *'  # æ¯ 6 å°æ—¶æ‰§è¡Œä¸€æ¬¡
  workflow_dispatch:  # æ”¯æŒæ‰‹åŠ¨è§¦å‘

permissions:
  contents: write  # æ˜ç¡®æˆäºˆå†™å…¥æƒé™

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»“åº“
        uses: actions/checkout@v4
        with:
          ref: main

      - name: æ‹‰å–é…ç½®
        run: |
          echo "ğŸ“¥ å¼€å§‹ä¸‹è½½é…ç½®æ–‡ä»¶..."
          curl -f -o config.txt "https://odd-hall-95d8.1430066373.workers.dev/?config=1&encode=base58"
          if [ $? -eq 0 ]; then
            echo "âœ… é…ç½®æ–‡ä»¶ä¸‹è½½æˆåŠŸ"
            echo "ğŸ“¦ æ–‡ä»¶å¤§å°: $(wc -c < config.txt) bytes"
            ls -lh config.txt
          else
            echo "âŒ é…ç½®æ–‡ä»¶ä¸‹è½½å¤±è´¥"
            exit 1
          fi

      - name: æäº¤æ›´æ–°
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          # æ·»åŠ æ–‡ä»¶
          git add config.txt

          # æ£€æŸ¥æ˜¯å¦æœ‰å˜æ›´ï¼ˆä½¿ç”¨ git statusï¼‰
          if git diff --staged --quiet; then
            echo "â„¹ï¸ é…ç½®æ–‡ä»¶æ²¡æœ‰å˜åŒ–ï¼Œè·³è¿‡æäº¤"
          else
            echo "ğŸ“ æ£€æµ‹åˆ°é…ç½®å˜æ›´ï¼Œå‡†å¤‡æäº¤..."
            git commit -m "ğŸ”„ è‡ªåŠ¨åŒæ­¥é…ç½® - $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
            git push origin main
            echo "âœ… é…ç½®å·²åŒæ­¥åˆ° main åˆ†æ”¯"
          fi
